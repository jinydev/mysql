# 03 SQL 
요즘 사용하는 대부분의 데이터베이스 시스템은 관계형 모델을 바탕으로 설계되어 있습 니다. 관계형 데이터 베이스 시스템을 사용하기 위해서는 이를 명령하고 처리할 수 있는 별도의 SQL 명령을 학습해야 합니다. 
즉, SQL 명령문을 사용한다는 것은 해당 데이터베이스가 관계형 모델이라는 것을 말합 니다. 개발자들이 자신의 주력 언어 이외에도 또 다른 새로운 언어를 학습한다는 것은 부 담스러운 일입니다. 또한 새로운 언어를 학습한다는 것은 기술을 적용하는 데 진입장벽이 될 수도 있습니다. 하지만 데이터베이스 시스템은 현대 IT 기술에서 매우 유용하고 핵심 적인 부분이라 반드시 학습하고 다양한 아이디어를 융합하는 것이 중요합니다. 

## 03.1.SQL 시작 
관계형 데이터베이스를 주로 사용되는 명령 방식은 SQL 명령입니다. SQL(Structured Query Language) 언어는 처음 IBM에서 시작된 언어입니다. 관계형 데이터베이스의 아버 지인 Edgar F.Codd 박사 또한 IBM 연구원 출신입니다. 
SQL 언어는 간단한 명령어의 집합 형태로 구성되어 있습니다. SQL 언어는 관계형 데이 터베이스 시스템에 테이블 생성, 자료 삽입, 수정, 조회 등의 다양한 작업 명령을 지시할 수 있습니다. 
대부분의 데이터베이스는 관계형으로 공통적으로 SQL 언어를 지원합니다. 따라서 이제 데이터베이스에서 SQL 언어는 표준 언어로 자리를 잡아 가고 있습니다. 또한 SQL 언어 는 ANSI(American National Standards Institute) 표준을 따라 한 번의 학습으로 다양한 데 이터베이스 시스템에 적용하여 사용할 수 있습니다. 하지만 다른 몇 개의 데이터베이스는 약간의 다른 문법을 사용하는 경우도 있습니다. 
오라클은 PL/SQL, SQL Server 는 T-SQL이라고 하기도 합니다. MySQL은 표준 SQL을 따릅니다. SQL 언어 하나의 학습으로 다양한 데이터베이스를 사용할 수 있다는 것은 개 발 환경의 개선과 다양한 시스템을 적용하는 데 있어서 기술 장벽을 낮추는 효과가 발생 합니다. 

## 03.2.SQL 연동 
데이터베이스는 데이터 처리를 위해서 콘솔 화면을 통하여 SQL 명령을 실행할 수 있습 니다. 데이터베이스는 이러한 조작에 필요한 클라이언트 단말 응용프로그램을 제공하고 있지만 별도의 외부 프로그램을 함께 처리하기 위해서는 연동 작업이 필요합니다. 
데이터베이스는 콘솔 터미널 작업을 위해서 별도의 GUI 환경을 제공하는 경우도 있습 니다. 이러한 환경은 사람과 데이터베이스 사이의 데이터를 기준으로 하는 인터페이스입 니다. 데이터베이스와 프로그램 간의 처리를 위한 인터페이스는 바로 SQL 명령문의 전달 과 처리입니다. 
데이터베이스와 연동하여 프로그램을 작성하기 위해서는 반드시 SQL 언어를 사전에 학 습해야 합니다. 대부분의 작업 명령을 SQL로 생성하여 프로그램에서 데이터베이스로 전 송하기 때문입니다. 
당연히 PHP에서도 데이터베이스를 연동하기 위해서는 SQL 명령문을 사용합니다. PHP 
는 데이터베이스에 접속하고 작성한 SQL 명령을 전송함으로써 DB 작업을 수행합니다. 
PHP 언어만 알고 SQL을 모른다면 데이터베이스를 바로 연동할 수는 없습니다. 
데이터베이스는 기본 별개의 서비스 프로그램입니다. SQL 명령을 사용하지 않고 직접적 으로 데이터베이스 관련 파일들에 접근하여 작업할 수는 없습니다. 기존의 언어와 데이터 베이스를 연동하기 위해서는 데이터베이스 언어인 SQL 문법을 알고 있어야 합니다. 
SQL 언어를 배우면 MySQL 이외에 다양한 데이터베이스 시스템을 PHP에서도 사용할 수 있습니다. SQL 언어를 배운다는 것은 다양한 데이터베이스 시스템을 활용할 수 있는 능력을 향상시키는 것입니다. 

## 03.3.작성 방법 
SQL 명령은 다른 프로그래밍 언어들보다 복잡하고 어렵지 않습니다. 몇 개의 키워드와 작성 순서 요령만 터득하면 쉽게 사용할 수 있습니다. 

### 03.3.1 구성 
SQL 명령은 크게 세 가지 요소로 구성되어 있습니다. 
● 명령을 지정하는 부분(select .. from …) 
● 검색 조건(where 절) 
● 정렬 방법(order by 절) 

단순한 구조로 되어 있습니다. 하지만 단순한 명령들을 잘 조합하면 보다 정교한 데이터 베이스 작업을 할 수 있는 강력한 명령 언어입니다. 

### 03.3.2 대소문자 
SQL 언어는 대소문자를 구분하지 않습니다. 대문자 또는 소문자로 사용하거나, 또는 낙 타표기법 스타일로 섞어서 사용할 수도 있습니다. 
● CREATE DATABASE 
● Create Database 
● create database 

따라서 위와 같은 대소문자를 섞어서 사용한 SQL도 같은 문장으로 해석됩니다. 

### 03.3.3 최적화 
데이터베이스 SQL 명령은 간결하게 명령을 작성합니다. 관계형 데이터베이스는 입력된 SQL 쿼리 명령을 분석하고 데이터베이스를 처리합니다. 
또한 관계형 데이터베이스는 다수의 테이블에 분할하고, 수많은 자료들을 디스크에 저장 하기 때문에 하드웨어 적인 성능 부분을 많이 고려가 필요합니다. 하드웨어의 성능과 처리 속도를 고려한 쿼리 문장의 생성은 자원을 효율적으로 사용하는 데 중요한 요소입니다. 
최근의 하드웨어 성능은 나날이 발전되고 있습니다. 하드웨어 성능으로 인한 속도 부분은 많이 개선되었지만 이와 비례하여 서비스의 접속과 사용자들이 많아지고 있습니다. 이로 인해 효율적인 쿼리의 작성은 이전보다 더 중요합니다. 
SQL 쿼리 명령은 관계형 데이터베이스를 활용하는데 매우 중요한 언어입니다. 또한 작성 에 많은 부분을 고려해야 하는 요소이기도 합니다. 


## 03.4.SQL 구분 
SQL 명령은 1개 단위 또는 여러 개의 단위를 묶어서 실행할 수 있습니다. 

### 03.4.1 세미콜론 
PHP 에서는 각각의 명령을 구분하기 위해서 마지막에 구분 기호로 세미콜론 (;)을 삽입합 니다. SQL 명령 또한 1개의 쿼리 명령문을 구분하기 위해서 동일한 기호의 세미콜론을 사용합니다. 

| 쿼리 문법 | 
```
SQL 명령어; 
```

| 콘솔 실습 화면 | 
```
mysql> select * from members -> ; 
```

명령을 작성할 때 세미콜론을 작성하지 않으면 오류를 발생하거나 추가로 입력 (->)을 요 구하기도 합니다. 만일 세미콜론이 없는 경우에는 오류가 발생할 수 있습니다. 
경우에 따라서는 종결 기호 세미콜론을 다른 기호로 변경할 수 있습니다. 

### 03.4.2 기호 변경 
SQL에서 기본적인 종결 기호는 세미콜론입니다. 하지만 프로시저나 트리거 등의 향상된 SQL 쿼리 명령을 실행해야 할 경우 세미콜론 기호는 중복되어 쿼리 실행에 오류를 줄 수 있습니다. 
이런 경우 임시로 종결 기호를 다른 기호 형태로 변경하여 입력을 처리할 수 있습니다. DELIMITER 키워드는 종결 문자를 변경하는 SQL 명령문입니다. 

| 쿼리 문법 | 
```
DELIMITER 기호 
```
만일 DELIMITER //로 입력하면 종결 문자는 //로 변경됩니다. 다시 DELIMITER ;로 하면 종결 문자는 다시 세미콜론으로 복원됩니다. 


## 03.5.오류 
관계형 데이터베이스는 입력되는 SQL 쿼리 문장을 읽고 분석하여 데이터를 처리합니다. 따라서 정확한 동작을 위해서는 정확한 키워드와 문법을 맞추어 작성해야 합니다. 
만일 SQL 문법에 어긋나거나 잘못된 키워드, 철자 오류 등이 있을 경우 시스템은 에러 메 시지를 출력합니다. 아래 화면은 콘솔에서 철자가 틀린 명령어를 입력한 예입니다. 

| 콘솔 실습 화면 | 
```
mysql> create databas jiny; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'databas jiny' at line 1 
```
이렇게 콘솔에서 오류 메시지를 출력하는 것은 사용자 입장에서 매우 편리합니다. 오류를 
바로 확인하여 수정할 수 있기 때문입니다. 
하지만 PHP와 같이 프로그램을 연동하여 SQL 명령문을 전달하는 경우 오류 메시지를 받아서 처리할 수 없습니다. 따라서 SQL 명령문을 작성할 때 정확히 철자와 문법에 맞추 어 작성하는 것이 중요합니다. 

## 03.6.데이터 반환 
SQL 쿼리 명령의 동작에는 크게 두 가지의 종류가 있습니다. 출력 결과 반환이 있는 명령 문과 출력 반환이 없는 명령문입니다. 
use, delimiter와 같은 명령은 데이터베이스에 실행 명령을 하지만 출력 결과는 없는 명 
령입니다. 그냥 데이터베이스 시스템에 명령을 전달하는 역할만 수행합니다. 

| 콘솔 실습 화면 | 
```
mysql> use jiny; Database changed 
```

데이터 출력은 없고 결과 메시지만 출력합니다. 
이와 달리 show, select와 같은 명령은 데이터를 반환하는 명령문입니다. 데이터베이스 는 입력된 명령을 분석하여 실행 후에 결과값을 다시 화면에 출력합니다. 

| 콘솔 실습 화면 | 
```
mysql> select * from members; +----+---------+-----------+---------+------+--------+---------+-----------+ | Id | LastName | FirstName | Address | City | Country | manager | email    | +----+---------+-----------+---------+------+--------+---------+-----------+ 
| 1  | hojin | lee | shinchon  | seoul | korea | infohojin | hojin@hojin.io  |  
| 2 | jiny | NULL | NULL  | NULL | korea | infohojin | jiny@hojin.io  |  
| 3 | james | kim | youngdun-po | seoul | korea | info  | james@hojin.io  |  

+----+---------+-----------+---------+------+--------+---------+-----------+ 3 rows in set (0.00 sec) 
```

위의 화면은 회원 목록을 출력하는 select 명령입니다. 명령에 반응한 데이터를 출력합 니다. 


## 03.7.주석 처리 
다수의 SQL 명령을 작성하는 경우도 있을 것입니다. 명령들이 많아 별도의 .sql 파일 로 저장할 수도 있습니다. 하지만 모든 명령이 실행되는 것으로 작성해야 하는 것은 아닙 니다. 
SQL 언어도 PHP와 같이 특정 SQL을 배제하거나 설명하기 위해서 주석 처리 기능을 제 공합니다. 주석 처리는 1개씩 명령을 수행하는 것과 달리 별도의 SQL 명령 파일을 통하 여 일괄 작업할 때 사용하면 편리합니다. 
SQL 주석은 PHP와 같이 두 가지 방법을 모두 지원합니다. 주석으로 처리된 내용은 MySQL에서는 실행되지 않습니다. 

### 03.7.1 한 줄 주석 
한 줄 주석은 라인의 시작 부분에 --를 입력하면 됩니다. 한 줄 주석은 지정한 한 줄만 주석으로 처리되어 실행되지 않습니다. 
-- 이 부분은 주석입니다. --Select all: --SELECT * FROM members; SELECT * FROM members; 
주석은 SQL의 설명 또는 명령을 주석으로 처리할 수 있습니다. 
SELECT * FROM members --WHERE City='Seoul'; 
또한 문장의 중간에 --가 삽입되면 시작 위치부터 한 줄 끝까지 주석으로 처리되어 실행 부분에서 제외됩니다. 

### 03.7.2 여러 줄 주석 
여러 줄의 주석은 / *로 시작하여 */로 끝나는 부분으로 다중 주석 처리를 할 수 있습니다. 지정한 블록 부분 전체를 주석으로 처리하는 방법입니다. 

```sql
/*Select all the columns 
of all the records 
in the members table:*/ 
SELECT * FROM members; 
```

또한 명령 중간에도 /* ~ */ 부분을 만나면 sql 실행에서 제외됩니다. 

```
/*SELECT * FROM Customers; SELECT * FROM Products; SELECT * FROM Orders; SELECT * FROM Categories;*/ 
SELECT * FROM Suppliers; 
SELECT userName, /*City,*/ Country FROM members; 
```

주석 처리는 베이터베이스를 백업하거나 복구할 때 유용하게 사용할 수 있는 기능입니다. 보통 mysqldump와 같이 백업 명령을 수행하여 작업할 때 기본적인 주석 설명이 함께 생성됩니다. 
